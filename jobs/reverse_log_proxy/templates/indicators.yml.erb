---
apiVersion: v0

product:
  name: loggregator
  version: latest

metadata:
  deployment: <%= spec.deployment %>

indicators:
- name: rlp_subscriptions
  promql: avg(avg_over_time(subscriptions{source_id="reverse_log_proxy"}[5m]))
  thresholds:
  - level: critical
    gte: 900
  documentation:
    title: RLP Subscriptions
    description: |
      Within PAS, the Reverse Log Proxy (RLP) limits the number of subscriptions.
      A subscription is a consumer of the RLP; this metric concerns the number of
      concurrent consumer of an RLP instance. The maximum subscription count is 1000
      per RLP.

      This metric indicates that the RLP has reached its concurrent consumer limit.
    recommended_response: |
      Increase the number of RLPs when the average number of rlp.subscriptions is greater
      than 900.

layout:
  owner: Loggregator Team
  title: Loggregator
  description: |
     This topic explains how to monitor the health of Cloud Foundry
     Loggregator using the metrics and key performance indicators (KPIs)
     generated by the service.
  sections:
  - title: Key Performance Indicators for Loggregator
    description: This section describes the KPIs that you can use to monitor the health of Loggregator.
    indicators:
    - rlp_subscriptions